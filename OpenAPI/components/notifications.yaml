# Notification and Alert Schemas
# Schema definitions for notifications, alerts, and webhooks

NotificationChannel:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Channel identifier
      example: "550e8400-e29b-41d4-a716-446655440002"
    name:
      type: string
      description: Channel name
      example: "Slack Engineering Alerts"
      maxLength: 255
    type:
      type: string
      enum:
        - email
        - slack
        - discord
        - webhook
        - sms
        - telegram
      description: Notification channel type
      example: slack
    configuration:
      type: object
      description: Channel-specific configuration
      oneOf:
        - $ref: '#/EmailConfig'
        - $ref: '#/SlackConfig'
        - $ref: '#/WebhookConfig'
        - $ref: '#/SmsConfig'
    is_active:
      type: boolean
      description: Whether channel is active
      example: true
    created_at:
      type: string
      format: date-time
      example: "2024-01-15T10:30:00Z"
  required:
    - id
    - name
    - type
    - configuration
    - is_active
    - created_at

EmailConfig:
  type: object
  properties:
    recipients:
      type: array
      items:
        type: string
        format: email
      description: Email recipients
      example: ["admin@company.com", "alerts@company.com"]
    sender_email:
      type: string
      format: email
      description: Sender email address
      example: "noreply@envable.com"
    subject_template:
      type: string
      description: Email subject template
      example: "[ENVable] {severity}: {title}"
  required:
    - recipients

SlackConfig:
  type: object
  properties:
    webhook_url:
      type: string
      format: uri
      description: Slack webhook URL
      example: "https://hooks.slack.com/services/YOUR_WORKSPACE/YOUR_CHANNEL/YOUR_WEBHOOK_TOKEN"
    channel:
      type: string
      description: Slack channel
      example: "#alerts"
    username:
      type: string
      description: Bot username
      example: "ENVable Bot"
      default: "ENVable"
  required:
    - webhook_url

WebhookConfig:
  type: object
  properties:
    url:
      type: string
      format: uri
      description: Webhook URL
      example: "https://api.company.com/webhooks/envable"
    method:
      type: string
      enum:
        - POST
        - PUT
      description: HTTP method
      example: POST
      default: POST
    headers:
      type: object
      additionalProperties:
        type: string
      description: Custom headers
      example:
        "X-API-Key": "webhook-secret-key"
        "Content-Type": "application/json"
    timeout_seconds:
      type: integer
      description: Request timeout
      example: 30
      default: 30
  required:
    - url

SmsConfig:
  type: object
  properties:
    phone_numbers:
      type: array
      items:
        type: string
        pattern: '^\+[1-9]\d{1,14}$'
      description: Phone numbers in E.164 format
      example: ["+1234567890", "+1987654321"]
    sender_id:
      type: string
      description: SMS sender ID
      example: "ENVable"
      maxLength: 11
  required:
    - phone_numbers

NotificationRule:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Rule identifier
      example: "550e8400-e29b-41d4-a716-446655440003"
    name:
      type: string
      description: Rule name
      example: "Critical Alert Rule"
      maxLength: 255
    description:
      type: string
      nullable: true
      description: Rule description
      example: "Send critical alerts to all channels"
    conditions:
      type: object
      properties:
        severity_levels:
          type: array
          items:
            type: string
            enum:
              - info
              - warning
              - error
              - critical
          description: Alert severity levels to match
          example: ["error", "critical"]
        source_patterns:
          type: array
          items:
            type: string
          description: Source patterns to match
          example: ["credential-*", "auth-*"]
        keywords:
          type: array
          items:
            type: string
          description: Keywords to match in alert content
          example: ["timeout", "failure", "unauthorized"]
        time_window:
          type: object
          properties:
            start_time:
              type: string
              pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
              description: Start time (HH:MM)
              example: "09:00"
            end_time:
              type: string
              pattern: '^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$'
              description: End time (HH:MM)
              example: "17:00"
            timezone:
              type: string
              description: Timezone
              example: "UTC"
              default: "UTC"
    channels:
      type: array
      items:
        type: string
        format: uuid
      description: Notification channels to use
      example: ["550e8400-e29b-41d4-a716-446655440002"]
    is_active:
      type: boolean
      description: Whether rule is active
      example: true
    created_at:
      type: string
      format: date-time
      example: "2024-01-15T10:30:00Z"
  required:
    - id
    - name
    - conditions
    - channels
    - is_active
    - created_at

NotificationHistory:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Notification identifier
      example: "550e8400-e29b-41d4-a716-446655440004"
    alert_id:
      type: string
      format: uuid
      description: Associated alert ID
      example: "550e8400-e29b-41d4-a716-446655440001"
    channel_id:
      type: string
      format: uuid
      description: Notification channel used
      example: "550e8400-e29b-41d4-a716-446655440002"
    status:
      type: string
      enum:
        - pending
        - sent
        - failed
        - retrying
      description: Notification status
      example: sent
    sent_at:
      type: string
      format: date-time
      description: When notification was sent
      example: "2024-01-20T15:25:30Z"
    delivery_attempts:
      type: integer
      description: Number of delivery attempts
      example: 1
    error_message:
      type: string
      nullable: true
      description: Error message if failed
    response_data:
      type: object
      nullable: true
      additionalProperties: true
      description: Response data from notification service
  required:
    - id
    - alert_id
    - channel_id
    - status
    - delivery_attempts