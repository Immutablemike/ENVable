# Credential Management Schemas
# Schema definitions for credential storage and management

CredentialSummary:
  type: object
  properties:
    id:
      type: string
      format: uuid
      description: Unique credential identifier
      example: "550e8400-e29b-41d4-a716-446655440000"
    name:
      type: string
      description: Human-readable credential name
      example: "OpenAI Production Key"
      maxLength: 255
    service:
      $ref: './services.yaml#/ServiceType'
    credential_type:
      $ref: './services.yaml#/CredentialType'
    is_active:
      type: boolean
      description: Whether the credential is currently active
      example: true
    created_at:
      type: string
      format: date-time
      description: When the credential was created
      example: "2024-01-15T10:30:00Z"
    last_used:
      type: string
      format: date-time
      nullable: true
      description: When the credential was last accessed
      example: "2024-01-20T15:45:00Z"
    expires_at:
      type: string
      format: date-time
      nullable: true
      description: When the credential expires (if applicable)
      example: "2024-12-31T23:59:59Z"
  required:
    - id
    - name
    - service
    - credential_type
    - is_active
    - created_at

CredentialResponse:
  allOf:
    - $ref: '#/CredentialSummary'
    - type: object
      properties:
        description:
          type: string
          nullable: true
          description: Optional credential description
          example: "Production API key for OpenAI GPT-4 access"
          maxLength: 1000
        tags:
          type: array
          items:
            type: string
          description: Tags for organization
          example: ["production", "ai", "api"]
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata
          example:
            project: "chatbot-v2"
            environment: "production"
            cost_center: "engineering"
        usage_stats:
          type: object
          properties:
            total_requests:
              type: integer
              description: Total API requests made
              example: 15420
            last_30_days:
              type: integer
              description: Requests in last 30 days
              example: 2340
          nullable: true

CreateCredentialRequest:
  type: object
  properties:
    name:
      type: string
      description: Human-readable credential name
      example: "OpenAI Production Key"
      maxLength: 255
    service:
      $ref: './services.yaml#/ServiceType'
    credential_type:
      $ref: './services.yaml#/CredentialType'
    value:
      type: string
      description: The credential value (will be encrypted)
      format: password
      example: "sk-xxxxxxxxxxxxxxxxxxxx"
    description:
      type: string
      nullable: true
      description: Optional description
      example: "Production API key for OpenAI services"
      maxLength: 1000
    tags:
      type: array
      items:
        type: string
      description: Organization tags
      example: ["production", "ai"]
    is_active:
      type: boolean
      default: true
      description: Whether credential should be active
    expires_at:
      type: string
      format: date-time
      nullable: true
      description: Optional expiration date
      example: "2024-12-31T23:59:59Z"
    metadata:
      type: object
      additionalProperties: true
      description: Additional metadata
      example:
        project: "chatbot-v2"
        environment: "production"
  required:
    - name
    - service
    - credential_type
    - value

UpdateCredentialRequest:
  type: object
  properties:
    name:
      type: string
      description: Human-readable credential name
      example: "OpenAI Production Key (Updated)"
      maxLength: 255
    value:
      type: string
      description: Updated credential value
      format: password
      example: "sk-newxxxxxxxxxxxxxxxxx"
    description:
      type: string
      nullable: true
      description: Updated description
      example: "Updated production key with new permissions"
      maxLength: 1000
    tags:
      type: array
      items:
        type: string
      description: Updated tags
      example: ["production", "ai", "updated"]
    is_active:
      type: boolean
      description: Whether credential should be active
      example: true
    expires_at:
      type: string
      format: date-time
      nullable: true
      description: Updated expiration date
      example: "2025-12-31T23:59:59Z"
    metadata:
      type: object
      additionalProperties: true
      description: Updated metadata

CredentialValidationRequest:
  type: object
  properties:
    credential_id:
      type: string
      format: uuid
      description: Credential to validate
    test_endpoint:
      type: string
      format: uri
      nullable: true
      description: Optional test endpoint
  required:
    - credential_id

CredentialValidationResponse:
  type: object
  properties:
    is_valid:
      type: boolean
      description: Whether the credential is valid
    tested_at:
      type: string
      format: date-time
      description: When the validation was performed
    response_time_ms:
      type: integer
      description: Test response time in milliseconds
      nullable: true
    error_message:
      type: string
      nullable: true
      description: Error message if validation failed
    status_code:
      type: integer
      nullable: true
      description: HTTP status code from test
  required:
    - is_valid
    - tested_at